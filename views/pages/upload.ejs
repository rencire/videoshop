<html>

<head>
    <link rel="stylesheet" href="/public/stylesheets/macys-base.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js">
    </script>

<!-- added js script here, might need to find a better place to put it -->
    <script type="text/javascript" charset="utf-8">

      function get_signed_request(file){
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/api/sign_s3?file_name="+file.name+"&file_type="+file.type);
        xhr.onreadystatechange = function(){
          if(xhr.readyState === 4){
            if(xhr.status === 200){
              var response = JSON.parse(xhr.responseText);
              upload_file(file, response.signed_request, response.url);
            } else {
              alert("Could not get signed URL.");
            }
          }
        };
        xhr.send();
      }

      function upload_file(file, signed_request, url){
        var xhr = new XMLHttpRequest();
        xhr.open("PUT", signed_request);
        xhr.setRequestHeader('x-amz-acl', 'public-read');
        xhr.onload = function() {
          if (xhr.status === 200) {
            // do stuff here once file is uploaded
            // we should update preview image with generated 'url' from upload
            document.getElementById("video-preview").src = url;
            document.getElementById("video-url").value = url;
          }
        };
        xhr.onerror = function() {
          alert("Could not upload file.");
        };
        xhr.send(file);
      }

      document.addEventListener("DOMContentLoaded", function() {
        document.getElementById("video-file-input").onchange = function(){
          var files = document.getElementById("video-file-input").files;
          console.log("files:");
          console.log(files);
          var file = files[1];
          if(file == null){
            alert("No file selected.");
          }
          else{
            get_signed_request(file);
          }
        };
      });
    </script>
</head>

<body>
    <!-- <video id="video-preview" src="" controls>
    </video>-->

    <!-- need video-url, category, shop-link -->
    <form action="/upload" method="post" enctype="application/x-www-form-urlencoded">
      <div class="row">
        <div class="large-6 columns">
          <label>Choose Category:</label>
          <input type="radio" name="men" value="men" id="categoryMen">
          <label for="categoryMen">Men</label>

          <input type="radio" name="men" value="women" id="categoryWomen">
          <label for="categoryWomen">Women</label>
        </div>

      <input type="hidden" id="video-url" name="video-url" value="some_video_url" />

     <div class="row">
       <div class="small-7 small-centered columns">
          <input class="button large" type="submit" value="Post Video">
       </div>
     </div>
   </form>



</body>

</html>
